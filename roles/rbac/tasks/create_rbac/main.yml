---
# Variables are below.
# rbac: RBAC object that contains 'network_name', 'project_name', args that

# TODO: It will be replaced to environment variable.
- name: "Declare auth_parameters if \"auth_ref\" is existed at (group_vars.openstack.servers.[].name == {{ server.name }})"
  set_fact:
    auth_parameters: "{{ group_vars.openstack.auth['default'] }}"

- name: Declare target_rbac_projects
  set_fact:
    target_rbac_projects: []

# Create admin_projects_list from domains and projects belonging in it.
- name: Declare a variable of admin project list
  set_fact:
    admin_projects_list: "[{% for item in rbac_domain.projects if 'admin' in item.name %}{{ item }}{% if not loop.last %},{% endif %}{% endfor %}]"




# TODO: Declare rbac_project_id
# TODO: Declare target_rbac_network_id
# TODO: Declare action

- name: Deeeeeeeeeeeeeeeeeeeebug
  ansible.builtin.debug:
    "target_project_id={{ rbac_project_id }}, action={{ rbac.action }}, object_id={{ target_rbac_network_id }}"

- name: Faaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaail
  ansible.builtin.fail:
    msg: "oooooooooooooooooooooooooooooooooooooooooooooooooooooooooooo"

#- name: "Create a new network RBAC policy [project_name={{ rbac.project_name }}, target_project_id={{ rbac.target_project_id }}]"
#  neutron_rbac_policy:

#- name: "Create a new network RBAC policy. project_name={{ rbac.project_name }}, target_project_id={{ rbac.target_project_id }}"
#  neutron_rbac_policy:
#    object_id:                      # network_id
#    object_type: 'network'          # RBAC 
#    target_project_id: "{{ target_project_id }}"              # Project ID that the network belonging in.
#    action: "{{ rbac.action }}"

